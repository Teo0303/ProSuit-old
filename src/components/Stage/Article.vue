<template>
  <div class="container main">
    <div class="player">
      <!-- :audio="currentAudio" -->
      <Player></Player>
    </div>
    <div class="content flex article-content">
      <article class="main-bg">
        <h1 class="article-title">
          <img src="../../assets/headphone.png" alt />
          Содержание указа президента РУз от 18 Апреля 2019 года
        </h1>
        <p class="article-content">
          Fugiat laborum dolor adipisicing duis sint ea duis voluptate. Tempor labore esse incididunt esse exercitation cillum qui eu Lorem tempor eiusmod proident. Officia mollit proident eiusmod nulla nisi aliqua culpa. Aute nulla duis eiusmod reprehenderit. Lorem non qui amet aliquip laboris voluptate ut. Laboris voluptate sint ut sint qui.
          <br />Adipisicing ipsum enim sint pariatur officia nulla nisi velit occaecat esse voluptate dolore est. Elit sit non irure duis dolore laborum cupidatat. Excepteur pariatur sunt officia amet nostrud esse pariatur minim Lorem laborum laboris.
          <br />In nostrud do esse in et adipisicing ex nulla cillum non consectetur sit labore enim. Ex laborum nisi in veniam ullamco sint nisi sunt amet excepteur Lorem. Et anim irure sunt culpa officia et sunt nostrud occaecat voluptate do veniam. Sint proident ipsum id nisi pariatur tempor ex mollit voluptate amet anim nisi. Enim qui fugiat esse irure magna non quis. Consectetur in laboris incididunt culpa excepteur deserunt irure laborum sint.
          <br />Pariatur id dolor sunt exercitation nulla ipsum est adipisicing occaecat sunt sint. Consectetur cillum incididunt sunt laboris officia in eiusmod eu. Consequat consequat laboris voluptate mollit sit consectetur elit aliquip. Pariatur esse dolor fugiat adipisicing exercitation excepteur in cupidatat exercitation tempor elit.
          <br />Enim irure consectetur tempor do mollit culpa mollit fugiat eu anim dolore qui aliquip. Magna dolore qui id ut aliqua in pariatur nisi et anim ut pariatur minim proident. Ut officia ea sunt magna in pariatur officia cupidatat nisi anim nulla non reprehenderit fugiat. Laborum cillum in amet ipsum ullamco aliquip proident quis qui tempor excepteur do proident. In non Lorem elit ex minim nulla est deserunt sunt. Veniam proident magna esse amet deserunt incididunt officia veniam duis in. In ullamco elit pariatur officia ipsum tempor officia esse culpa id dolore id nostrud.
          Fugiat laborum dolor adipisicing duis sint ea duis voluptate. Tempor labore esse incididunt esse exercitation cillum qui eu Lorem tempor eiusmod proident. Officia mollit proident eiusmod nulla nisi aliqua culpa. Aute nulla duis eiusmod reprehenderit. Lorem non qui amet aliquip laboris voluptate ut. Laboris voluptate sint ut sint qui.
          <br />Adipisicing ipsum enim sint pariatur officia nulla nisi velit occaecat esse voluptate dolore est. Elit sit non irure duis dolore laborum cupidatat. Excepteur pariatur sunt officia amet nostrud esse pariatur minim Lorem laborum laboris.
          <br />In nostrud do esse in et adipisicing ex nulla cillum non consectetur sit labore enim. Ex laborum nisi in veniam ullamco sint nisi sunt amet excepteur Lorem. Et anim irure sunt culpa officia et sunt nostrud occaecat voluptate do veniam. Sint proident ipsum id nisi pariatur tempor ex mollit voluptate amet anim nisi. Enim qui fugiat esse irure magna non quis. Consectetur in laboris incididunt culpa excepteur deserunt irure laborum sint.
          <br />Pariatur id dolor sunt exercitation nulla ipsum est adipisicing occaecat sunt sint. Consectetur cillum incididunt sunt laboris officia in eiusmod eu. Consequat consequat laboris voluptate mollit sit consectetur elit aliquip. Pariatur esse dolor fugiat adipisicing exercitation excepteur in cupidatat exercitation tempor elit.
          <br />Enim irure consectetur tempor do mollit culpa mollit fugiat eu anim dolore qui aliquip. Magna dolore qui id ut aliqua in pariatur nisi et anim ut pariatur minim proident. Ut officia ea sunt magna in pariatur officia cupidatat nisi anim nulla non reprehenderit fugiat. Laborum cillum in amet ipsum ullamco aliquip proident quis qui tempor excepteur do proident. In non Lorem elit ex minim nulla est deserunt sunt. Veniam proident magna esse amet deserunt incididunt officia veniam duis in. In ullamco elit pariatur officia ipsum tempor officia esse culpa id dolore id nostrud.
          Fugiat laborum dolor adipisicing duis sint ea duis voluptate. Tempor labore esse incididunt esse exercitation cillum qui eu Lorem tempor eiusmod proident. Officia mollit proident eiusmod nulla nisi aliqua culpa. Aute nulla duis eiusmod reprehenderit. Lorem non qui amet aliquip laboris voluptate ut. Laboris voluptate sint ut sint qui.
          <br />Adipisicing ipsum enim sint pariatur officia nulla nisi velit occaecat esse voluptate dolore est. Elit sit non irure duis dolore laborum cupidatat. Excepteur pariatur sunt officia amet nostrud esse pariatur minim Lorem laborum laboris.
          <br />In nostrud do esse in et adipisicing ex nulla cillum non consectetur sit labore enim. Ex laborum nisi in veniam ullamco sint nisi sunt amet excepteur Lorem. Et anim irure sunt culpa officia et sunt nostrud occaecat voluptate do veniam. Sint proident ipsum id nisi pariatur tempor ex mollit voluptate amet anim nisi. Enim qui fugiat esse irure magna non quis. Consectetur in laboris incididunt culpa excepteur deserunt irure laborum sint.
          <br />Pariatur id dolor sunt exercitation nulla ipsum est adipisicing occaecat sunt sint. Consectetur cillum incididunt sunt laboris officia in eiusmod eu. Consequat consequat laboris voluptate mollit sit consectetur elit aliquip. Pariatur esse dolor fugiat adipisicing exercitation excepteur in cupidatat exercitation tempor elit.
          <br />Enim irure consectetur tempor do mollit culpa mollit fugiat eu anim dolore qui aliquip. Magna dolore qui id ut aliqua in pariatur nisi et anim ut pariatur minim proident. Ut officia ea sunt magna in pariatur officia cupidatat nisi anim nulla non reprehenderit fugiat. Laborum cillum in amet ipsum ullamco aliquip proident quis qui tempor excepteur do proident. In non Lorem elit ex minim nulla est deserunt sunt. Veniam proident magna esse amet deserunt incididunt officia veniam duis in. In ullamco elit pariatur officia ipsum tempor officia esse culpa id dolore id nostrud.
          Fugiat laborum dolor adipisicing duis sint ea duis voluptate. Tempor labore esse incididunt esse exercitation cillum qui eu Lorem tempor eiusmod proident. Officia mollit proident eiusmod nulla nisi aliqua culpa. Aute nulla duis eiusmod reprehenderit. Lorem non qui amet aliquip laboris voluptate ut. Laboris voluptate sint ut sint qui.
          <br />Adipisicing ipsum enim sint pariatur officia nulla nisi velit occaecat esse voluptate dolore est. Elit sit non irure duis dolore laborum cupidatat. Excepteur pariatur sunt officia amet nostrud esse pariatur minim Lorem laborum laboris.
          <br />In nostrud do esse in et adipisicing ex nulla cillum non consectetur sit labore enim. Ex laborum nisi in veniam ullamco sint nisi sunt amet excepteur Lorem. Et anim irure sunt culpa officia et sunt nostrud occaecat voluptate do veniam. Sint proident ipsum id nisi pariatur tempor ex mollit voluptate amet anim nisi. Enim qui fugiat esse irure magna non quis. Consectetur in laboris incididunt culpa excepteur deserunt irure laborum sint.
          <br />Pariatur id dolor sunt exercitation nulla ipsum est adipisicing occaecat sunt sint. Consectetur cillum incididunt sunt laboris officia in eiusmod eu. Consequat consequat laboris voluptate mollit sit consectetur elit aliquip. Pariatur esse dolor fugiat adipisicing exercitation excepteur in cupidatat exercitation tempor elit.
          <br />Enim irure consectetur tempor do mollit culpa mollit fugiat eu anim dolore qui aliquip. Magna dolore qui id ut aliqua in pariatur nisi et anim ut pariatur minim proident. Ut officia ea sunt magna in pariatur officia cupidatat nisi anim nulla non reprehenderit fugiat. Laborum cillum in amet ipsum ullamco aliquip proident quis qui tempor excepteur do proident. In non Lorem elit ex minim nulla est deserunt sunt. Veniam proident magna esse amet deserunt incididunt officia veniam duis in. In ullamco elit pariatur officia ipsum tempor officia esse culpa id dolore id nostrud.
          Fugiat laborum dolor adipisicing duis sint ea duis voluptate. Tempor labore esse incididunt esse exercitation cillum qui eu Lorem tempor eiusmod proident. Officia mollit proident eiusmod nulla nisi aliqua culpa. Aute nulla duis eiusmod reprehenderit. Lorem non qui amet aliquip laboris voluptate ut. Laboris voluptate sint ut sint qui.
          <br />Adipisicing ipsum enim sint pariatur officia nulla nisi velit occaecat esse voluptate dolore est. Elit sit non irure duis dolore laborum cupidatat. Excepteur pariatur sunt officia amet nostrud esse pariatur minim Lorem laborum laboris.
          <br />In nostrud do esse in et adipisicing ex nulla cillum non consectetur sit labore enim. Ex laborum nisi in veniam ullamco sint nisi sunt amet excepteur Lorem. Et anim irure sunt culpa officia et sunt nostrud occaecat voluptate do veniam. Sint proident ipsum id nisi pariatur tempor ex mollit voluptate amet anim nisi. Enim qui fugiat esse irure magna non quis. Consectetur in laboris incididunt culpa excepteur deserunt irure laborum sint.
          <br />Pariatur id dolor sunt exercitation nulla ipsum est adipisicing occaecat sunt sint. Consectetur cillum incididunt sunt laboris officia in eiusmod eu. Consequat consequat laboris voluptate mollit sit consectetur elit aliquip. Pariatur esse dolor fugiat adipisicing exercitation excepteur in cupidatat exercitation tempor elit.
          <br />Enim irure consectetur tempor do mollit culpa mollit fugiat eu anim dolore qui aliquip. Magna dolore qui id ut aliqua in pariatur nisi et anim ut pariatur minim proident. Ut officia ea sunt magna in pariatur officia cupidatat nisi anim nulla non reprehenderit fugiat. Laborum cillum in amet ipsum ullamco aliquip proident quis qui tempor excepteur do proident. In non Lorem elit ex minim nulla est deserunt sunt. Veniam proident magna esse amet deserunt incididunt officia veniam duis in. In ullamco elit pariatur officia ipsum tempor officia esse culpa id dolore id nostrud.
        </p>
        <div
          class="audio-file"
          v-for="(audio, index) in files"
          :key="index"
          @click="changeSong(index), isPlaylistActive = !isPlaylistActive"
        >
          <div class="audio-file-btn" @click="playAudio()">
            <a @click="playAudio(index)">
              <!-- <transition> -->
              <span class="audio-icon">{{currentlyStopped ? '⏹' : (currentlyPlaying ? '❚❚' : '▶')}}</span>
              <!-- </transition> -->
            </a>

            <!-- <img src="../../assets/headphone.png" @is-playing="setPlaying" />
            <img src="../../assets/pause.png" alt />-->
          </div>
          <div class="audio-file-process">
            <p class="audio-file-title">{{audio.title}}</p>
            <div class="audio-process-bar">
              <div class="audio-process-bar-active" :style="{width: currentProgressBar + '%'}"></div>
            </div>
          </div>
        </div>

        <div class="line"></div>
        <div class="btn-group flex space-between">
          <button class="btn btn-primary ps-64 outlined">Предыдущий</button>
          <button class="btn btn-primary ps-64 btn-dark">Пройти тест</button>
        </div>
      </article>

      <div class="sidebar main-bg">
        <div class="current flex">
          <div class="icon">
            <img src="../../assets/List-blue.png" alt />
          </div>
          <p class="item-title">Содержание указа президента РУз от 18 Апреля 2019 года</p>
        </div>
        <div class="next">
          <p class="next-title">Следующий</p>
          <div>
            <div class="next-item flex">
              <div class="icon">
                <img src="../../assets/List-blue.png" alt />
              </div>
              <p class="item-title">Содержание указа президента РУз от 18 Апреля 2019 года</p>
            </div>
            <div class="next-item flex">
              <div class="icon">
                <img src="../../assets/List-blue.png" alt />
              </div>
              <p class="item-title">Содержание указа президента РУз от 18 Апреля 2019 года</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import Player from "../Player";
import { files } from "../modules/level/api";

export default {
  data() {
    return {
      files: files,
      musicPlaylist: [
        {
          title: "Service Bell",
          artist: "Daniel Simion",
          url: "https://soundbible.com/mp3/service-bell_daniel_simion.mp3",
          image: "https://source.unsplash.com/crs2vlkSe98/400x400"
        },
        {
          title: "Meadowlark",
          artist: "Daniel Simion",
          url: "https://soundbible.com/mp3/meadowlark_daniel-simion.mp3",
          image: "https://source.unsplash.com/35bE_njbG9E/400x400"
        },
        {
          title: "Hyena Laughing",
          artist: "Daniel Simion",
          url: "https://soundbible.com/mp3/hyena-laugh_daniel-simion.mp3",
          image: "https://source.unsplash.com/Esax9RaEl2I/400x400"
        },
        {
          title: "Creepy Background",
          artist: "Daniel Simion",
          url: "http://soundbible.com/mp3/creepy-background-daniel_simon.mp3",
          image: "https://source.unsplash.com/j0g8taxHZa0/400x400"
        }
      ],
      audio: "",
      currentlyPlaying: false,
      currentlyStopped: false,
      currentTime: 0,
      checkingCurrentPositionInTrack: "",
      trackDuration: 0,
      currentProgressBar: 0,
      isPlaylistActive: false,
      currentSong: 0,
      debug: false,
      currentAudio: String,
      playing: true,
      audioFile: ""
    };
  },
  components: {
    Player
  },

  computed: {
    setPlaying() {
      this.playing = false;
    }
  },

  mounted() {
    this.changeSong();
    this.audio.loop = false;
  },

  methods: {
    playAudio: function(index) {
      if (
        this.currentlyStopped == true &&
        this.currentSong + 1 == this.musicPlaylist.length
      ) {
        this.currentSong = 0;
        this.changeSong();
      }
      if (!this.currentlyPlaying) {
        this.getCurrentTimeEverySecond(true);
        this.currentlyPlaying = true;
        this.audio.play();
      } else {
        this.stopAudio();
      }
      this.currentlyStopped = false;
    },

    stopAudio: function() {
      this.audio.pause();
      this.currentlyPlaying = false;
      this.pausedMusic();
    },

    onImageLoaded: function() {
      this.imgLoaded = true;
    },

    getCurrentTimeEverySecond: function(startStop) {
      var localThis = this;
      this.checkingCurrentPositionInTrack = setTimeout(
        function() {
          localThis.currentTime = localThis.audio.currentTime;
          localThis.currentProgressBar =
            (localThis.audio.currentTime / localThis.trackDuration) * 100;
          localThis.getCurrentTimeEverySecond(true);
        }.bind(this),
        1000
      );
    },
    pausedMusic: function() {
      clearTimeout(this.checkingCurrentPositionInTrack);
    },
    toggleDebug: function() {
      this.debug = !this.debug;
      document.body.classList.toggle("debug");
    },

    handleEnded: function() {
      if (this.currentSong + 1 == this.musicPlaylist.length) {
        this.stopAudio();
        this.currentlyPlaying = false;
        this.currentlyStopped = true;
      } else {
        this.currentlyPlaying = false;
        this.currentSong++;
        this.changeSong();
        this.playAudio();
      }
    },

    changeSong: function(index) {
      var wasPlaying = this.currentlyPlaying;
      this.imageLoaded = false;
      if (index !== undefined) {
        this.stopAudio();
        this.currentSong = index;
      }
      this.audioFile = this.musicPlaylist[this.currentSong].url;
      this.audio = new Audio(this.audioFile);
      var localThis = this;
      this.audio.addEventListener("loadedmetadata", function() {
        localThis.trackDuration = Math.round(this.duration);
      });
      this.audio.addEventListener("ended", this.handleEnded);
      if (wasPlaying) {
        this.playAudio();
      }
    },

    isCurrentSong: function(index) {
      if (this.currentSong == index) {
        return true;
      }
      return false;
    },

    getCurrentSong: function(currentSong) {
      return this.musicPlaylist[currentSong].url;
    }
  },

  filters: {
    fancyTimeFormat: function(s) {
      return (s - (s %= 60)) / 60 + (9 < s ? ":" : ":0") + s;
    }
  },

  watch: {
    currentTime: function() {
      this.currentTime = Math.round(this.currentTime);
    }
  },

  beforeDestroy: function() {
    this.audio.removeEventListener("ended", this.handleEnded);
    this.audio.removeEventListener("loadedmetadata", this.handleEnded);

    clearTimeout(this.checkingCurrentPositionInTrack);
  }
};
</script>

<style>
/***************** Audio start*/
.player {
  padding-left: 256px;
}

.audio-file {
  display: flex;
  margin: 24px 0;
  align-items: center;
}

.audio-file-process {
  margin-left: 8px;
}

.audio-file-title {
  margin-bottom: 8px;
  font-size: 12px;
  line-height: 14px;
  letter-spacing: 0.01em;

  color: #acacac;
}

.audio-time {
  font-size: 10px;
  line-height: 10px;
  letter-spacing: 0.01em;

  color: #bbbbbb;
}

.audio-process-bar {
  width: 100%;
  height: 4px;
  background-color: #f4f4f4;
}

.audio-process-bar-active {
  width: 20%;
  height: 4px;
  background-color: #109cf1;
  position: relative;
}

.audio-process-bar-active:after {
  content: " ";
  background-color: #109cf1;
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  top: -2.1px;
  right: -5px;
}

.audio-file-btn {
  width: 36px;
  height: 36px;
  background-color: #109cf1;
  position: relative;
  border-radius: 50%;
}

.audio-file-btn img {
  position: absolute;
  top: 11px;
  left: 13px;
}

/***************** Audio end*/

article {
  text-align: left;
  padding: 25px 32px 25px 32px;
  width: 67%;
}

.article-content .sidebar {
  height: 277px;
}

.sidebar {
  text-align: left;
  margin-left: 30px;
  width: 33%;
}

.current,
.next {
  padding-left: 32px;
  padding-right: 32px;
}

.current,
.next {
  padding-top: 24px;
  padding-bottom: 24px;
}

.next-title {
  font-size: 10px;
  line-height: 12px;
  letter-spacing: 0.01em;
  color: #acacac;
}

.item-title {
  margin-left: 17px;
  font-size: 15px;
  line-height: 18px;
  letter-spacing: 0.01em;
}

.next {
  background-color: #f8f8f8;
}

.next-item {
  padding: 16px 0;
}

.next-item:not(:last-child) {
  border-bottom: 1px solid #dcdcdc;
}

.article-title {
  font-size: 18px;
  line-height: 21px;
  margin-bottom: 25px;
  letter-spacing: 0.01em;
}
.article-content {
  font-size: 15px;
  line-height: 18px;
  letter-spacing: 0.01em;
}
.go-back {
  font-size: 13px;
  line-height: 16px;
  letter-spacing: 0.01em;
  color: #109cf1;
  display: flex;
  align-items: center;
}

.go-back p {
  margin-left: 14px;
}

.go-back img {
  width: 18px;
}

.audio-icon {
  color: #fff;
  position: absolute;
  left: 12px;
  top: 7px;
}

@media screen and (max-width: 768px) {
  .player {
    padding-left: 0;
  }

  .article-content .sidebar {
    display: none;
  }

  .article-content article {
    width: 100%;
  }
}
</style>

